<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Telefonparty starten</title>
    <style>
        /* === Grundlayout === */
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to right, #e0f0ff, #f5faff);
            color: #1a1a1a;
        }

        /* === Container & Formularbox === */
        .main-container {
            display: flex;
            justify-content: center;
            padding: 3rem 2rem;
            max-width: 900px;
            margin: auto;
            animation: fadeIn 1s ease-in-out;
        }

        .form-section {
            flex: 1;
            max-width: 550px;
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: slideInLeft 0.8s ease;
        }

        /* === Logo / Ãœberschrift === */
        .logo {
            color: #007BFF;
            font-size: 2rem;
            text-align: center;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }

        /* === Formularfelder === */
        form label {
            display: block;
            margin: 1rem 0 0.4rem;
            font-weight: 500;
        }

        form input, form select {
            width: 100%;
            padding: 0.7rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        form input:focus, form select:focus {
            border-color: #007BFF;
            outline: none;
            box-shadow: 0 0 4px #007BFF;
        }

        form select#anrede {
            appearance: none;
            background: white url("data:image/svg+xml;utf8,<svg fill='%23007BFF' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>") no-repeat right 0.75rem center/1rem;
        }

        /* === Layout Gruppen === */
        .form-group { margin-bottom: 1rem; }
        .two-columns, .three-columns { display: flex; gap: 1rem; }
        .two-columns > div, .three-columns > div { flex: 1; display: flex; flex-direction: column; }

        /* === Submit-Button === */
        button[type="submit"] {
            background: #007BFF;
            color: #fff;
            border: none;
            width: 100%;
            padding: 0.9rem;
            border-radius: 6px;
            margin-top: 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        button[type="submit"]:hover { background: #0056b3; }

        /* === Toast === */
        #toast {
            position: fixed;
            top: 20px;
            right: 20px;
            margin: 0;
            text-align: center;
            z-index: 1000;

            background: #007BFF;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);

            max-width: 200px;
            max-height: 60px;
        }

        .move-to-corner {
            animation: moveToCorner 1s ease;
        }

        /* === Animations === */
        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
        @keyframes slideInLeft { from {transform:translateX(-50px);opacity:0;} to {transform:translateX(0);opacity:1;} }
        @keyframes moveToCorner { 0% { top:-50px; opacity: 0; } 100% { top:20px; right:20px; opacity: 1; transform:none; } }

        /* === Responsive === */
        @media (max-width:768px) { .two-columns { flex-direction: column; } }
    </style>


</head>
<body>

<div id="toast" style="visibility: hidden;">
    Telefonparty wurde gestartet!
</div>

<div class="main-container">
  <section class="form-section">
    <div class="logo">Telefonparty starten</div>
    <form id="phoneparty-form">
            <div class="form-group two-columns">
        <div>
          <label for="start-zeit">Start Uhrzeit</label>
          <input type="time" id="start-zeit" name="start-zeit" required>
        </div>
        <div>
          <label for="end-zeit">End Uhrzeit</label>
          <input type="time" id="end-zeit" name="end-zeit">
        </div>
      </div>

      <button type="submit">Telefonparty starten</button>
    </form>
  </section>
</div>

</body>

<script>
	const form = document.getElementById('phoneparty-form');
	form.addEventListener('submit', (e) => {
		e.preventDefault();

		let start = combineDateTime(document.getElementById('start-zeit').value);
		let end = combineDateTime(document.getElementById('end-zeit').value);

		let data = createWebsocket(start, end);
        if(data) {
            showToast();
        }
	});

	async function createWebsocket(start, ende) {
		try {
			const response = await fetch('/api/websocket/erstellen', {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({ start, ende }),
				credentials: "include"
			});

			if (!response.ok) {
				const errorData = await response.json();
				throw new Error(errorData.error || `HTTP error ${response.status}`);
			}

			const data = await response.json();
			console.log("Response:", data);
			return data;
		} catch (err) {
			console.error("API call failed:", err);
		}
	}

    function combineDateTime(timeStr) {
        if (!timeStr) return null;

        const today = new Date();
        const [hours, minutes] = timeStr.split(':').map(Number);
        today.setHours(hours, minutes, 0, 0); // seconds and ms = 0
        return today.toISOString();
    }

    function showToast() {
        const toast = document.getElementById('toast');
        toast.style.visibility = 'visible';
        toast.classList.add('move-to-corner');
        setTimeout(() => {
            toast.style.visibility = 'hidden';
            toast.classList.remove('move-to-corner');
        }, 3000)
    }

</script>
</html>
